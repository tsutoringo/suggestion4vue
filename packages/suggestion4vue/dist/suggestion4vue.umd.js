(function(c,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("@tsutoringo/vue-utils")):typeof define=="function"&&define.amd?define(["exports","vue","@tsutoringo/vue-utils"],e):(c=typeof globalThis<"u"?globalThis:c||self,e(c.suggestion4vue={},c.Vue,c.vueUtils))})(this,function(c,e,B){"use strict";const _=()=>{const l=e.reactive(new Map),t=e.ref([]),i=e.ref(!0),n=e.ref(void 0),p=(a,I)=>{l.set(a,I)},f=a=>{l.delete(a)},s=(a,I)=>{const h=l.get(a);!h||(h.index=I)},m=()=>{!n.value||n.value.pick()},u=()=>i.value=!0,o=()=>i.value=!1,d=()=>{n.value=n.value?t.value[n.value.index+1]:t.value[0],g()},r=()=>{n.value=n.value?t.value[n.value.index-1]:t.value[t.value.length-1],g()},g=()=>{n.value&&n.value.select()};return{items:l,indexedItems:t,addItem:p,removeItem:f,setItemIndex:s,openBox:u,closeBox:o,selectedItem:n,selectItem:m,clearIndexedItems:()=>t.value=[],addItemToIndexedItems:a=>{const I=l.get(a);if(!I){console.warn(`Unknown item ${a}`);return}t.value.push(I)},next:d,prev:r}},v=Symbol("suggestion"),w=()=>{var t,i;const l=e.inject(v);if(!l)throw new Error(`${((t=e.getCurrentInstance())==null?void 0:t.type.name)||((i=e.getCurrentInstance())==null?void 0:i.type.__name)||"this component"} must be included in the SearchBox.`);return l},k={name:"SuggestionItem"},x=e.defineComponent({...k,emits:["pick","select"],setup(l,{emit:t}){const{addItem:i,removeItem:n,closeBox:p,selectedItem:f}=w(),s=e.getCurrentInstance(),m=()=>{p(),t("pick")},u=()=>{t("select")},o=e.reactive({index:0,pick:m,select:u}),d=e.computed(()=>f.value===o);return e.onMounted(()=>{!(s!=null&&s.uid)||i(s.uid,o)}),e.onUnmounted(()=>{!(s!=null&&s.uid)||n(s.uid)}),(r,g)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["suggestion-item",{selected:e.unref(d)}]),onClick:g[0]||(g[0]=M=>m())},[e.renderSlot(r.$slots,"default",{index:o.index})],2))}}),y=e.defineComponent({name:"SuggestionBox",setup(l,{slots:t}){const i=e.computed(()=>e.renderSlot(t,"default")),n=_();e.provide(v,n);const{setItemIndex:p,clearIndexedItems:f,addItemToIndexedItems:s}=n;return e.watch(n.items,()=>{var u;if(!i.value)return;const m=B.getVNodesByType([i.value],x);f();for(let o=0;o<m.length;o++){const r=(u=m[o].component)==null?void 0:u.uid;!r||(p(r,o),s(r))}}),()=>e.h("div",{class:"suggestion-box"},[e.h(i.value)])}}),S=e.defineComponent({__name:"SuggestionInput",props:{modelValue:{default:""}},emits:["update:modelValue","enter"],setup(l,{emit:t}){const i=l,{selectedItem:n,selectItem:p,next:f,prev:s}=w(),m=o=>{n.value||t("enter",o),p()},u=e.computed({get:()=>i.modelValue,set:o=>t("update:modelValue",o)});return(o,d)=>e.withDirectives((e.openBlock(),e.createElementBlock("input",{type:"search","onUpdate:modelValue":d[0]||(d[0]=r=>e.isRef(u)?u.value=r:null),onKeydown:[d[1]||(d[1]=e.withKeys(e.withModifiers(r=>m(r),["prevent"]),["enter"])),d[2]||(d[2]=e.withKeys(e.withModifiers(r=>e.unref(f)(),["prevent"]),["down"])),d[3]||(d[3]=e.withKeys(e.withModifiers(r=>e.unref(s)(),["prevent"]),["up"]))]},null,544)),[[e.vModelText,e.unref(u)]])}}),C={Box:y,Input:S,Item:x};c.Box=y,c.Input=S,c.Item=x,c.default=C,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
